#!/bin/bash

SCRIPT_LOCATION=$(dirname `readlink -f $0`);
ITEM_TEMPLATE_DIR="$SCRIPT_LOCATION/../definitions/items/"
CATEGORY_TEMPLATE_DIR="$SCRIPT_LOCATION/../definitions/categories/"
LIBRARY_TEMPLATE_DIR="$SCRIPT_LOCATION/../definitions/library/"
GENERATED_CODE_DIR="$SCRIPT_LOCATION/../autogenerated/"

mkdir -p $GENERATED_CODE_DIR

echo "Generating Item source files from templates: "
for item in $(find $ITEM_TEMPLATE_DIR/*.xml); do

  ITEM_FILENAME="${item##*/}"
  ITEM_BASENAME="${ITEM_FILENAME%.*}"

  echo "  $ITEM_FILENAME"
  xsltproc -o $GENERATED_CODE_DIR/${ITEM_BASENAME}.hpp $ITEM_TEMPLATE_DIR/item-template.xsl $item
done

echo "Generating Category source files from templates: "
for cat in $(find $CATEGORY_TEMPLATE_DIR/*.xml); do

  CATEGORY_FILENAME="${cat##*/}"
  CATEGORY_BASENAME="${CATEGORY_FILENAME%.*}"

  echo "  $CATEGORY_FILENAME"
  xsltproc -o $GENERATED_CODE_DIR/${CATEGORY_BASENAME}.hpp $CATEGORY_TEMPLATE_DIR/category-template.xsl $cat
done

echo "Generating top level library files; "
xsltproc -o $GENERATED_CODE_DIR/astericxx.hpp $LIBRARY_TEMPLATE_DIR/astericxx.xsl $LIBRARY_TEMPLATE_DIR/astericxx.xml